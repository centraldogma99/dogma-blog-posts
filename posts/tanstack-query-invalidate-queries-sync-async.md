---
title: TanStack Queryì˜ invalidateQueriesëŠ” ì–¸ì œ awaitì´ í•„ìš”í• ê¹Œ?
subtitle: invalidateQueriesì˜ ë™ê¸°ì  stale í‘œì‹œì™€ ë¹„ë™ê¸° refetch ë™ì‘ì„ ì´í•´í•˜ê³ , awaitì„ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
date: 2025-01-14
draft: true
tag:
  - tanstack-query
  - react-query
  - cache-management
---

## TL;DR

- `invalidateQueries`ëŠ” **await ì—†ì´ í˜¸ì¶œí•´ë„ ìºì‹œë¥¼ ì¦‰ì‹œ staleë¡œ í‘œì‹œ**í•©ë‹ˆë‹¤
- awaitì€ ìºì‹œ ë¬´íš¨í™”ê°€ ì•„ë‹Œ **refetch ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒ**ì…ë‹ˆë‹¤
- êµ¬ë…ìê°€ ì—†ìœ¼ë©´ refetch ìì²´ê°€ ì¼ì–´ë‚˜ì§€ ì•Šì•„ awaitì´ ë¬´ì˜ë¯¸í•©ë‹ˆë‹¤
- **ëŒ€ë¶€ë¶„ì˜ ê²½ìš° awaitì€ ë¶ˆí•„ìš”**í•©ë‹ˆë‹¤ - React Queryê°€ ì•Œì•„ì„œ UIë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤

## ë“¤ì–´ê°€ë©°

TanStack Queryë¥¼ ì‚¬ìš©í•˜ë‹¤ ë³´ë©´ ì´ëŸ° ì½”ë“œë¥¼ ìì£¼ ë³´ê²Œ ë©ë‹ˆë‹¤:

```tsx
// ì–´ë–¤ ê°œë°œìì˜ ì½”ë“œ
await queryClient.invalidateQueries({ queryKey: ['todos'] })

// ë‹¤ë¥¸ ê°œë°œìì˜ ì½”ë“œ  
queryClient.invalidateQueries({ queryKey: ['todos'] })
```

ê°™ì€ `invalidateQueries`ì¸ë° ì™œ ì–´ë–¤ ì‚¬ëŒì€ `await`ì„ ë¶™ì´ê³ , ì–´ë–¤ ì‚¬ëŒì€ ë¶™ì´ì§€ ì•Šì„ê¹Œìš”? 

ë” í˜¼ë€ìŠ¤ëŸ¬ìš´ ê±´, **ë‘˜ ë‹¤ ì œëŒ€ë¡œ ë™ì‘í•œë‹¤**ëŠ” ì ì…ë‹ˆë‹¤. 

ì´ ê¸€ì—ì„œëŠ” ë§ì€ ê°œë°œìë“¤ì´ ëª¨ë¥´ê³  ìˆëŠ” `invalidateQueries`ì˜ ë™ì‘ ë°©ì‹ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## invalidateQueriesê°€ í•˜ëŠ” ë‘ ê°€ì§€ ì¼

`invalidateQueries`ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì§€ë§Œ, ì‚¬ì‹¤ ë‘ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. **ì¦‰ì‹œ ì‹¤í–‰**: ìºì‹œë¥¼ stale(ì˜¤ë˜ëœ ìƒíƒœ)ë¡œ í‘œì‹œ
2. **ë¹„ë™ê¸° ì‹¤í–‰**: ìºì‹œë¥¼ êµ¬ë…í•˜ê³  ìˆëŠ” ê³³ì´ ìˆìœ¼ë©´ refetch

ì´ë¥¼ ê°„ë‹¨íˆ í‘œí˜„í•˜ë©´:

```typescript
// invalidateQueriesì˜ ë™ì‘ ë°©ì‹ (ê°œë…ì  ì„¤ëª…)
async function invalidateQueries(queryKey) {
  // 1ë‹¨ê³„: ì¦‰ì‹œ ì‹¤í–‰ - ìºì‹œë¥¼ "ì˜¤ë˜ë¨"ìœ¼ë¡œ í‘œì‹œ
  markAsStale(queryKey)  // ì´ê±´ ë™ê¸°ì ìœ¼ë¡œ ë°”ë¡œ ì‹¤í–‰ë¨!
  
  // 2ë‹¨ê³„: ë¹„ë™ê¸° ì‹¤í–‰ - í•„ìš”í•œ ê²½ìš°ì—ë§Œ ìƒˆë¡œ fetch
  if (ì´_ë°ì´í„°ë¥¼_êµ¬ë…í•˜ëŠ”_ê³³ì´_ìˆëŠ”ê°€()) {
    await refetch(queryKey)  // ì´ê²ƒë§Œ ë¹„ë™ê¸°
  }
}
```

## í•µì‹¬: await ë¶™ì—¬ë„, ì•ˆ ë¶™ì—¬ë„ ìºì‹œëŠ” ì¦‰ì‹œ ë¬´íš¨í™”

ë§ì€ ê°œë°œìë“¤ì´ ì°©ê°í•˜ëŠ” ë¶€ë¶„ì´ ë°”ë¡œ ì´ê²ƒì…ë‹ˆë‹¤:

> "awaitì„ ì•ˆ ë¶™ì´ë©´ ìºì‹œ ë¬´íš¨í™”ê°€ ë‚˜ì¤‘ì— ì¼ì–´ë‚  ê±°ì•¼"

**ì•„ë‹™ë‹ˆë‹¤!** await ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ìºì‹œëŠ” **ì¦‰ì‹œ** staleë¡œ í‘œì‹œë©ë‹ˆë‹¤.

```tsx
// await ì—†ëŠ” ê²½ìš°
queryClient.invalidateQueries({ queryKey: ['todos'] })
// ğŸ‘† ì´ ì¤„ì´ ì‹¤í–‰ë˜ëŠ” ìˆœê°„ ìºì‹œëŠ” ì´ë¯¸ stale!

// await ìˆëŠ” ê²½ìš°  
await queryClient.invalidateQueries({ queryKey: ['todos'] })
// ğŸ‘† ìºì‹œê°€ staleë¡œ í‘œì‹œë˜ëŠ” íƒ€ì´ë°ì€ ìœ„ì™€ ë™ì¼!
// awaitì€ ë‹¨ì§€ refetchê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ ë¿
```

## í”í•œ ì˜¤í•´ë“¤

### ì˜¤í•´ 1: "awaitì„ ì•ˆ ë¶™ì´ë©´ ë¬´íš¨í™”ê°€ ì•ˆ ëœë‹¤"

```tsx
queryClient.invalidateQueries({ queryKey: ['todos'] })
// ğŸ‘† await ì—†ì–´ë„ ìºì‹œëŠ” ì¦‰ì‹œ stale ìƒíƒœê°€ ë©ë‹ˆë‹¤
```

ì´ë¯¸ staleë¡œ í‘œì‹œë˜ì—ˆê¸° ë•Œë¬¸ì—, ë‹¤ìŒë²ˆì— ì´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë˜ì—ˆì„ ë•Œ ìë™ìœ¼ë¡œ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

### ì˜¤í•´ 2: "awaitì„ ë¶™ì´ë©´ í•­ìƒ ì„œë²„ ìš”ì²­ì„ ê¸°ë‹¤ë¦°ë‹¤"

```tsx
// ì•„ë¬´ë„ ì´ ë°ì´í„°ë¥¼ êµ¬ë…í•˜ê³  ìˆì§€ ì•Šë‹¤ë©´?
await queryClient.invalidateQueries({ queryKey: ['unused-data'] })
// ğŸ‘† refetchê°€ ì¼ì–´ë‚˜ì§€ ì•Šì•„ì„œ ì¦‰ì‹œ ì™„ë£Œë¨
```

useQuery ë“±ìœ¼ë¡œ í•´ë‹¹ ë°ì´í„°ë¥¼ êµ¬ë…í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì—†ë‹¤ë©´, refetch ìì²´ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. awaitì„ ë¶™ì—¬ë„ ê¸°ë‹¤ë¦´ ê²Œ ì—†ì–´ì„œ ë°”ë¡œ ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.

### ì˜¤í•´ 3: "mutation í›„ì—ëŠ” í•­ìƒ awaitì„ ë¶™ì—¬ì•¼ í•œë‹¤"

```tsx
const { mutate } = useMutation({
  mutationFn: updateTodo,
  onSuccess: () => {
    // await ì—†ì–´ë„ ê´œì°®ìŠµë‹ˆë‹¤
    queryClient.invalidateQueries({ queryKey: ['todos'] })
    // React Queryê°€ ì•Œì•„ì„œ UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤
  }
})
```

ëŒ€ë¶€ë¶„ì˜ ê²½ìš° awaitì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤. useQueryë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì•Œì•„ì„œ ìƒˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

## ì •ë¦¬

`invalidateQueries`ì— ëŒ€í•´ ê¼­ ê¸°ì–µí•´ì•¼ í•  ì„¸ ê°€ì§€:

1. **ìºì‹œ ë¬´íš¨í™”ëŠ” í•­ìƒ ì¦‰ì‹œ ì¼ì–´ë‚œë‹¤** - await ë¶™ì´ë“  ì•ˆ ë¶™ì´ë“  ìƒê´€ì—†ìŒ
2. **awaitì€ refetchë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒ** - ìºì‹œ ë¬´íš¨í™”ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ê²Œ ì•„ë‹˜  
3. **ëŒ€ë¶€ë¶„ì˜ ê²½ìš° awaitì€ ë¶ˆí•„ìš”** - React Queryê°€ ì•Œì•„ì„œ UIë¥¼ ì—…ë°ì´íŠ¸í•¨

ê²°ë¡ : awaitì„ ë¶™ì¼ì§€ ë§ì§€ ê³ ë¯¼ëœë‹¤ë©´, **ì•ˆ ë¶™ì´ëŠ” ê²Œ ë§ì„ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤**. ì •ë§ë¡œ refetch ì™„ë£Œë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” íŠ¹ë³„í•œ ì´ìœ ê°€ ìˆì„ ë•Œë§Œ awaitì„ ì‚¬ìš©í•˜ì„¸ìš”.

## ì°¸ê³  ìë£Œ

- [TanStack Query - invalidateQueries ê³µì‹ ë¬¸ì„œ](https://tanstack.com/query/latest/docs/reference/QueryClient#queryclientinvalidatequeries)
- [Mastering Mutations in React Query](https://tkdodo.eu/blog/mastering-mutations-in-react-query)